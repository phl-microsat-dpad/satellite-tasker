{% extends "base.html" %}

{% block cssimports %}
<style>
    body {
        padding-top: 50px;
        padding-bottom: 50px;
    }

    #map {
        width: 100%;
        height: 100%;
    }

    .main-content {
        max-width: 800px;
    }

</style>
{% endblock %}

{% block content %}

<div class="main-content">
    <h1>Imagery Request Form</h1>

    <form id="order-form">
        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-fname">First Name</label>
                <input type="text" class="form-control" id="order-fname" placeholder="First Name" name="fname"/>
            </div>
            <div class="form-group col-sm-6">
                <label for="order-lname">Last Name</label>
                <input type="text" class="form-control" id="order-lname" placeholder="Last Name" name="lname"/>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-12">
                <label for="order-institution">Institution</label>
                <input type="text" class="form-control" id="order-lname" placeholder="Institution" name="institution"/>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-12">
                <label for="order-address">Address</label>
                <input type="text" class="form-control" id="order-address" placeholder="Address" name="address"/>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-zip">Zip Code</label>
                <input type="text" class="form-control" id="order-zip" placeholder="Zip" name="zip"/>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-email">Email Address</label>
                <input type="email" class="form-control" id="order-email" placeholder="Email" name="email"/>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-phone">Phone</label>
                <input type="text" class="form-control" id="order-phone" placeholder="Phone" name="phone"/>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-type">Fax</label>
                <input type="text" class="form-control" id="order-fax" placeholder="Fax" name="fax"/>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-12">
                <label>Area of Interest</label>
                <div id="map"></div>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-field-of-app">Field of Application</label>
                <div class="radio">
                    <label><input type="radio" name="field-of-app">Research</label>
                </div>
                <div class="radio">
                    <label><input type="radio" name="field-of-app">Educational</label>
                </div>
                <div class="radio">
                    <label><input type="radio" name="field-of-app">Operational/Commercial Demonstration</label>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-area-of-study">Primary Area of Study</label>
                <select class="form-control" id="order-area-of-study" name="area-of-study">
                    <option>Agricultural</option>
                    <option>Climate / Atmospheric</option>
                    <option>Disaster and Calamities</option>
                    <option>Environmental Assessment</option>
                    <option>Infrastrucure</option>
                    <option>Scientific Research and Education</option>
                    <option>Water resources</option>
                    <option>Others</option>
                </select>
            </div>        
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-affiliation">Affiliation</label>
                <select class="form-control" id="order-affiliation" name="affiliation">
                    <option>Government</option>
                    <option>Academe</option>
                    <option>NGO</option>
                    <option>Private</option>
                </select>
            </div>    
        </div>

        <div class="row">
            <div class="form-group col-sm-6">
                <label for="order-">Order Message</label>
                <textarea class="form-control" name="message"></textarea>
            </div>
        </div>

        <input type="hidden" id="order-sw-long" name="sw-long" />
        <input type="hidden" id="order-sw-lat" name="sw-lat" />
        <input type="hidden" id="order-ne-long" name="ne-long" />
        <input type="hidden" id="order-ne-lat" name="ne-lat" />

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>
{% endblock %}

{% block jsimports %}
<script type="text/javascript">
    var areaSelect = null;

    $(document).ready(function(){
        $("#order-form").on("submit", function(e){
            e.preventDefault();

            var data = $("#order-form").serializeArray();
            console.log(data);

            var bounds = areaSelect.getBounds();
            var sw = bounds._southWest;
            var ne = bounds._northEast;

            var selection_geojson = JSON.stringify({
                "type": "Feature",
                "bbox": [sw.lng, sw.lat, ne.lng, ne.lat],
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [sw.lng, sw.lat],
                        [sw.lng, ne.lat],
                        [ne.lng, ne.lat],
                        [ne.lng, sw.lat]
                    ]
                }
            });

            data.push({
                name: "area-of-interest",
                value: selection_geojson
            })

            console.log(sw);
            console.log(ne);
            console.log(selection_geojson);
            $.post("/api/order", data);
        });

        initialize_map();
    });    

    function initialize_map(){
        // initialize map
        var map = L.map('map');

        var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
        var osm = new L.TileLayer(osmUrl, {minZoom: 2, maxZoom: 12, attribution: osmAttrib});       

        map.setView(new L.LatLng(11.5, 121.8), 6);
        map.addLayer(osm);

        // add AreaSelect with keepAspectRatio:true
        areaSelect = L.areaSelect({
            width:100, 
            height:100, 
        });
        areaSelect.addTo(map);
    }
</script>
{% endblock %}